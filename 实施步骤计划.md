# 项目实施步骤计划（两人半月至一月）

> 用作“计划书/待办事项表”，执行与留痕并重。所有任务均以复现与数据记录为目标。完成后在本表使用复选框打钩，并将任务文字加删除线标记（例如 `- [x] ~~完成示例~~`）。

## 标记与执行规则
- 完成标记：`- [x]` 并加删除线 `~~任务名~~`；进行中：`- [ ]`。
- 留痕规范：每次运行均使用 CLI 并生成 `experiments/run-YYYYMMDD_HHMMSS_<tag>_seed<SEED>/`，保存 `config.json`、`orders.json`、`schedule.json`、`metrics.json`、`summary.md`。
- 复现保障：固定随机种子；落盘所有输入；汇总图表与统计结果统一保存在 `paper/figures/`（创建后使用）。

## 里程碑总览
- M0 基础设施与规范
- M1 基线 GA + 解码器 + 适应度评估
- M2 GA增强（交叉/变异/可行性修复）
- M3 VNS/ILS 局部搜索集成
- M4 SA/TS 二次优化集成
- M5 对比算法（PSO 或 ACO）
- M6 批量实验与消融（3场景×30次）
- M7 论文撰写与交付

---

## M0 基础设施与规范
- [x] ~~初始化仓库结构（`src/`, `data/`, `results/`, `experiments/`）~~ 完成于 2025-11-01
- [x] ~~默认配置与订单样例（`data/config.json`, `data/orders.json`）~~ 完成于 2025-11-01
- [x] ~~CLI 入口（`python -m src.main`）打通运行~~ 完成于 2025-11-01
- [x] ~~实验运行记录器（`src/utils/run_logger.py`），自动落盘实验记录~~ 完成于 2025-11-01

执行命令示例：
```
python -m src.main --horizon 7 --generations 40 --pop 40 --pc 0.8 --pm 0.08 \
  --config data/config.json --orders data/orders.json --out results \
  --runs_dir experiments --exp_tag baseline-ga --seed 123
```

验收标准：
- 生成 `experiments/run-YYYYMMDD_HHMMSS_baseline-ga_seed123/`；`summary.md` 与 `metrics.json` 正常。

---

## M1 基线 GA + 解码器 + 适应度评估
- [x] ~~模型与实体（`src/models/entities.py`）~~ 完成于 2025-11-01
- [x] ~~EDD+利润密度解码器（`src/decoders/edd_decoder.py`）~~ 完成于 2025-11-01
- [x] ~~适应度评估（`src/evaluation/fitness.py`），输出利润与核心指标~~ 完成于 2025-11-01
- [x] ~~基线 GA（`src/algorithms/ga.py`）可运行并返回最优调度~~ 完成于 2025-11-01
- [x] ~~基线长跑收敛验证：`generations >= 300`，记录 5 次独立运行结果（`seed` 不同），输出均值±标准差。~~ 完成于 2025-11-01

执行命令示例：
```
python -m src.main --horizon 7 --generations 300 --pop 80 --pc 0.8 --pm 0.08 \
  --config data/config.json --orders data/orders.json --out results \
  --runs_dir experiments --exp_tag baseline-ga-longrun --seed 202
```

验收标准：
- 收敛曲线（可后续由 `plots` 生成）；`on_time_rate` 与 `profit` 有稳定趋势；结果目录完整。

---

## M2 GA 增强（交叉/变异/可行性修复）
- [x] ~~扩展块交叉：从“按天”到“按窗口（2–3 时段）”~~ 完成于 2025-11-02
- [x] ~~分层变异策略：产品切换、空闲插入、产量比例微调（如采用比例编码）~~ 完成于 2025-11-02
- [x] ~~可行性修复器：优先在低工资时段安排生产；限制夜间无效启动~~ 完成于 2025-11-02
- [x] ~~一致性测试：固定 `seed` 的重复运行，评估增强后稳定性~~ 完成于 2025-11-02

执行命令示例：
```
python -m src.main --horizon 7 --generations 300 --pop 100 --pc 0.9 --pm 0.12 \
  --config data/config.json --orders data/orders.json --out results \
  --runs_dir experiments --exp_tag ga-enhanced --seed 303
```

验收标准：
- 增强版在相同场景下的 `profit` 和（或）`wage_cost` 显著优于基线（≥5% 改善）；对 `on_time_rate` 的提升将在引入后续局部搜索后观察。

---

## M3 VNS/ILS 局部搜索集成
> **优化建议**：优先实现VNS（变邻域搜索），ILS可作为备选。如果时间紧张，可以只实现VNS的核心邻域操作。

- [x] ~~邻域1（小）：同线相邻时段产品交换~~ 完成于 2025-11-10（`src/algorithms/vns.py::_neighbor_swap_adjacent`）
- [x] ~~邻域2（中）：跨线同产品产量重分配~~ 完成于 2025-11-10（`_neighbor_cross_line_reassign`，按产品最紧急度偏置）
- [x] ~~邻域3（大）：时段块滑移（向低工资时段迁移）~~ 完成于 2025-11-10（`_neighbor_block_shift`）
- [x] ~~与 GA 串联：GA 产出后执行 VNS 若干轮，保留更优解~~ 完成于 2025-11-10（`src/main.py --local_search vns`）
- [ ] 单元测试与性能评估：小规模实例下 100 次移动的平均耗时与收益提升。
- [ ] **论文撰写开始**：完成M3后开始撰写"问题描述"和"算法设计"初稿。

执行命令示例：
```
python -m src.main --horizon 7 --generations 200 --pop 80 --pc 0.8 --pm 0.08 \
  --config data/config.json --orders data/orders.json --out results \
  --runs_dir experiments --exp_tag ga-vns --seed 404 \
  --local_search vns --ls_rounds 3 --ls_attempts 120
```

验收标准：
- 引入 VNS 后 `profit` 提升，`wage_cost` 降低（≥3%），保持或提升 `on_time_rate`；控制台输出包含 `[VNS] 局部搜索提升利润 ...` 提示。

阶段完成备注（M3 当前状态）：
- 已完成 3 个种子运行（404/405/406），详见 `实验步骤记录.md` 第 8 章。
- 控制台已出现 VNS 集成提示（如“未找到更优邻域解，保持GA最优: X”）。
- `experiments/` 下存在 `ga-vns` 标记的运行目录与指标文件。
- 本轮短视野（7天）下 VNS 未超过 GA，但利润为正且为后续引入“截止软约束权重”提供了稳定基线。

M3.1（软适应度引导）进展：
- [x] 软权重接入：`compute_soft_fitness` 与 GA 参数（`--soft_deadline/alpha/beta/gamma`）。
- [x] 实验记录：`experiments/run-20251110_145321_ga-vns-soft_seed404` 等目录与指标已写入 `实验步骤记录.md` 8.1 节。
- [x] 效果概览：在 7 天视野下，工资与生产成本显著下降，均值利润小幅提升；准时率受场景限制未改善。

  长视野扩展（14/30 天）：
  - [x] 批量运行完成（404/405/406），运行目录：
    - 14 天：`experiments/run-20251110_145831_ga-vns-soft-h14_seed404`、`...145839..._seed405`、`...145847..._seed406`
    - 30 天：`experiments/run-20251110_150016_ga-vns-soft-h30_seed404`、`...145947..._seed405`、`...150018..._seed406`
  - [x] 指标写入：见 `实验步骤记录.md` 8.2 节（均值：14 天利润 ≈ -91,817；30 天利润 ≈ -673,510；按时率=0；罚款触发=1）。
  - [x] 结论摘要：长视野下工资线性累计与固定罚金规则导致利润为负且按时率不改善；需校准截止期设定与工资模型或提升软适应度与邻域对“提前交付”的偏好。

---

## M4 SA/TS 二次优化集成
> **优化建议**：如果时间紧张，优先实现SA（模拟退火），TS可作为备选。核心路径：GA → VNS → SA。

- [x] SA 接入：初温自动估计；降温 `α≈0.95`；每温度尝试 100–300 移动。完成于 2025-11-10（`src/algorithms/sa.py`、`src/main.py`、`src/experiments/runner.py`）
- [ ] TS 接入：禁忌最近 10–30 次移动（产品切换/块滑移），避免回退（可选）。
- [ ] 混合策略：GA → VNS → SA/TS；比较不同顺序的效果。
- [ ] **论文撰写**：完善"算法设计"部分，开始"实验仿真"框架。

CLI 参数（SA）：
- `--sa_enabled` 开启 SA 二次优化
- `--sa_initial_temp` 初始温度，支持数值或 `auto`
- `--sa_cooling` 降温系数（默认 0.95）
- `--sa_moves_per_temp` 每温度尝试的移动次数（默认 150）
- `--sa_temps` 温度层数（默认 20）

执行命令示例（快速验证）：
```
python -m src.main --horizon 7 --generations 60 --pop 50 --pc 0.8 --pm 0.08 \
  --runs_dir experiments --exp_tag m4-sa-dev --seed 404 \
  --local_search vns --ls_rounds 2 --ls_attempts 60 \
  --sa_enabled --sa_temps 10 --sa_moves_per_temp 60
```

验收标准：
- `profit` 与 `on_time_rate` 双提升或在 `profit` 提升同时 `penalty` 降低；记录 SA 接受率与（若接入 TS）禁忌命中率。

阶段完成备注（M4 当前状态）：
- 已完成 7 天视野、种子 404 的快速验证运行；控制台输出包含 `[SA] 二次优化... (接受率 X.XXX)` 或未提升提示。
- 已生成 `experiments/run-*_m4-sa-dev_seed404` 目录与 `metrics.json`、`summary.md`。
- SA 已串联在 GA→VNS 之后，支持自动初温估计与参数化控制。

---

## M5 对比算法（至少其一）
> **优化建议**：优先实现PSO（粒子群优化），与GA对比更直观。ACO可作为备选或未来工作。如果时间非常紧张，可以简化对比算法或放在"优缺点与改进"中讨论。

- [x] ~~PSO 版本：将每线每时段产量比例与产品选择概率连续化；解码器保持一致。~~ 完成于 2025-11-11
  - 编码：连续空间编码订单优先级（0-1），维度=订单数
  - 解码：优先级→EDD+利润密度重排序，保持与GA一致
  - 适应度：使用强化软惩罚函数（alpha=1.5，beta=0.8，gamma=0.1）
  - 参数：粒子数20，迭代50，c1=2.0，c2=2.0，w=0.7
- [ ] ACO 版本：构造时段-产品序列；信息素奖励高利润密度与早完工；蒸发系数与启发项调优（可选）。
- [ ] 与 GA/GA+VNS/GA+SA/TS 对比：同场景与种子集合做 30 次重复。

执行命令示例：
```
# PSO算法运行示例
python -m src.main --horizon 7 --pso_enabled --pso_particles 20 --pso_iterations 50 \
  --pso_c1 2.0 --pso_c2 2.0 --pso_w 0.7 --soft_deadline --soft_alpha 1.5 --soft_beta 0.8 \
  --config data/config.json --orders data/orders.json --out results \
  --runs_dir experiments --exp_tag pso-baseline --seed 707
```

验收标准：
- 对比算法在至少一个指标上达到可比或更优；给出差异分析与消融结论。
- PSO初步测试：利润48,180，准时率75%，罚金率25%，显著优于GA典型表现

---

## M6 批量实验与消融（3 场景 × 30 次）
> **优化建议**：分阶段进行实验。先做核心对比（1场景×10次×3算法：GA、GA+VNS、GA+VNS+SA），验证效果后再扩展到完整规模。如果时间不够，至少完成1场景×30次的核心对比。

- [x] ~~阶段1（核心验证）~~：
  - 1个场景（默认场景）
  - 3个算法：GA、GA+VNS、GA+VNS+SA
  - 每个算法10次重复
- [x] **阶段2（完整对比）**（订单紧迫度场景）：
  - 场景设定：
    - 订单紧迫度（宽松/中等/紧张）：通过交付期限分布控制
      - 宽松(loose)：平均交付期限2.9天
      - 中等(medium)：平均交付期限1.4天  
      - 紧张(tight)：平均交付期限1.4天（更早到期）
  - 每个场景×算法组合30次重复
  - 算法对比：GA、GA-VNS、GA-VNS-SA、PSO
  - 实验规模：3场景 × 4算法 × 30次 = 360次实验
  - 状态：实验进行中，已生成部分结果数据
- [x] ~~批量 Runner（`src/experiments/runner.py`）：固定种子集合批量运行，自动汇总 CSV（已支持场景参数与自动追加 `exp_tag`）~~ 完成于 2025-11-10
- [ ] 统计检验：均值±标准差，Wilcoxon 或 t-test（视分布而定）。
- [ ] 图表生成：利润箱线图、准时率条形图、收敛曲线；输出至 `paper/figures/`。
- [x] ~~图表生成：利润箱线图、准时率/利用率/罚金触发率条形图，输出至 `paper/figures/`~~ 完成于 2025-11-10
- [ ] 文档迭代日志更新：为每个版本与重要实验添加一行记录。
- [ ] **论文撰写**：同步整理数据，撰写"实验仿真"部分。

执行命令示例：
```
# 伪示例：runner 参数以实现后为准
python -m src.experiments.runner --scenario wage-medium --algo ga-vns-sa-ts --repeat 30 --seeds 1..30
```

验收标准：
- 三场景×30次完整数据与图表；消融结论清晰；迭代日志完整。

---

### 阶段2（场景支持与三场景×10次验证）

场景参数与命令示例：
- 低/中/高工资场景通过 `--scenarios wage-low wage-medium wage-high` 指定，并开启 `--append_scenario_to_tag` 自动将场景名追加到实验标签：
```
# GA baseline（500–509各10次）
python -m src.experiments.runner --exp_tag ga-only-m6s2 \
  --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 \
  --scenarios wage-low wage-medium wage-high --append_scenario_to_tag \
  --seed-start 500 --seed-end 509

# GA+VNS（VNS：3轮×120尝试）
python -m src.experiments.runner --exp_tag ga-vns-m6s2 \
  --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 \
  --local_search vns --ls_rounds 3 --ls_attempts 120 \
  --scenarios wage-low wage-medium wage-high --append_scenario_to_tag \
  --seed-start 500 --seed-end 509

# GA+VNS+SA（SA：T0=800，降温0.95，每温度300步，30层）
python -m src.experiments.runner --exp_tag ga-vns-sa-m6s2 \
  --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 \
  --local_search vns --ls_rounds 3 --ls_attempts 120 \
  --sa_enabled --sa_initial_temp 800 --sa_cooling 0.95 --sa_moves_per_temp 300 --sa_temps 30 \
  --scenarios wage-low wage-medium wage-high --append_scenario_to_tag \
  --seed-start 500 --seed-end 509
```

本次三场景×10次（每算法）平均指标（去重按“同seed保留最后一行”）：
- 低工资场景（wage-low）：
  - GA：`profit=10930.00`，`utilization=0.6563`，`on_time=0.000`，`penalty_rate=1.000`
  - GA+VNS：`profit=11164.00`，`utilization=0.6595`，`on_time=0.013`，`penalty_rate=0.988`
  - GA+VNS+SA：`profit=17394.00`，`utilization=0.6952`，`on_time=0.150`，`penalty_rate=0.850`
- 中工资场景（wage-medium）：
  - GA：`profit=1886.00`，`utilization=0.5968`，`on_time=0.013`，`penalty_rate=0.988`
  - GA+VNS：`profit=1246.00`，`utilization=0.6095`，`on_time=0.025`，`penalty_rate=0.975`
  - GA+VNS+SA：`profit=8416.00`，`utilization=0.6825`，`on_time=0.163`，`penalty_rate=0.838`
- 高工资场景（wage-high）：
  - GA：`profit=-8316.00`，`utilization=0.5571`，`on_time=0.013`，`penalty_rate=0.988`
  - GA+VNS：`profit=-6556.00`，`utilization=0.5524`，`on_time=0.013`，`penalty_rate=0.988`
  - GA+VNS+SA：`profit=-478.00`，`utilization=0.6690`，`on_time=0.138`，`penalty_rate=0.863`

结论（阶段性）：
- SA 在三种工资场景下均显著提升利润与产线利用率，并降低罚金触发率；在高工资场景中将亏损显著缩小（由 GA 的 `-8316` 降至接近持平 `-478`）。
- 单独 VNS 相较 GA 的提升有限，说明在当前 7 天短视野与罚金规则下，SA 的“高温探索+接受机制”更有效。
- 准时率在引入 SA 后由 0 提升到 0.15–0.163（低/中场景），高工资场景亦有改善；建议下一步扩展到每场景 30 次以获得稳定统计。

后续安排：
- 将 `--seed-end` 扩展至 529，完成“三场景×30次×3算法”，并进行标准差与显著性检验；保持上述参数。
- 若需要更强的准时率，可在 `runner` 中启用软截止引导参数（`--soft_alpha/--soft_beta`）进行额外分批评估。

---

### 阶段2（三场景×30次完整对比与统计）

批量命令（三算法×三场景×30次，seed=500..529）：
```
# GA baseline（30次×三场景）
python -m src.experiments.runner --exp_tag ga-only-m6s2 \
  --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 \
  --scenarios wage-low wage-medium wage-high --append_scenario_to_tag \
  --seed-start 500 --seed-end 529

# GA+VNS（VNS：3轮×120尝试）
python -m src.experiments.runner --exp_tag ga-vns-m6s2 \
  --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 \
  --local_search vns --ls_rounds 3 --ls_attempts 120 \
  --scenarios wage-low wage-medium wage-high --append_scenario_to_tag \
  --seed-start 500 --seed-end 529

# GA+VNS+SA（SA：T0=800，降温0.95，每温度300步，30层）
python -m src.experiments.runner --exp_tag ga-vns-sa-m6s2 \
  --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 \
  --local_search vns --ls_rounds 3 --ls_attempts 120 \
  --sa_initial_temp 800 --sa_cooling 0.95 --sa_moves_per_temp 300 --sa_temps 30 \
  --scenarios wage-low wage-medium wage-high --append_scenario_to_tag \
  --seed-start 500 --seed-end 529
```

三场景×30次（去重按“同seed保留最后一行”）均值±标准差：
- 低工资场景（wage-low）
  - GA：`profit=13178.67 ± 3644.85`，`util=0.6513 ± 0.0418`，`on_time=0.004 ± 0.023`，`penalty_rate=0.996 ± 0.023`
  - GA+VNS：`profit=13010.67 ± 3515.98`，`util=0.6548 ± 0.0435`，`on_time=0.004 ± 0.023`，`penalty_rate=0.996 ± 0.023`
  - GA+VNS+SA：`profit=13567.33 ± 3114.20`，`util=0.6421 ± 0.0371`，`on_time=0.013 ± 0.038`，`penalty_rate=0.988 ± 0.038`
- 中工资场景（wage-medium）
  - GA：`profit=2618.67 ± 3589.32`，`util=0.6063 ± 0.0336`，`on_time=0.013 ± 0.038`，`penalty_rate=0.988 ± 0.038`
  - GA+VNS：`profit=2751.33 ± 3853.12`，`util=0.6087 ± 0.0339`，`on_time=0.008 ± 0.032`，`penalty_rate=0.992 ± 0.032`
  - GA+VNS+SA：`profit=2235.33 ± 3707.21`，`util=0.6029 ± 0.0368`，`on_time=0.008 ± 0.032`，`penalty_rate=0.992 ± 0.032`
- 高工资场景（wage-high）
  - GA：`profit=-8508.00 ± 3444.18`，`util=0.5463 ± 0.0326`，`on_time=0.004 ± 0.023`，`penalty_rate=0.996 ± 0.023`
  - GA+VNS：`profit=-8586.00 ± 3655.40`，`util=0.5505 ± 0.0346`，`on_time=0.004 ± 0.023`，`penalty_rate=0.996 ± 0.023`
  - GA+VNS+SA：`profit=-7972.00 ± 3648.58`，`util=0.5468 ± 0.0312`，`on_time=0.004 ± 0.023`，`penalty_rate=0.996 ± 0.023`

阶段性结论（30次统计）：
- 在本数据集与罚金设定下，GA 与 GA+VNS 的均值非常接近；SA 在低/高工资场景下利润小幅优于 GA，但中工资场景下接近或略低，说明 SA 的收益与罚金/工资的权衡相关。
- 准时率整体较低（0.004–0.013），罚金触发率高（≈0.99），提示订单截止与工资系数的矛盾仍然强烈；后续需引入更强的“软截止引导”或调整订单紧迫度场景进行更全面评估。

下一步（阶段2完善）：
- 进行显著性检验（t-test 或 Wilcoxon）与图表生成（箱线图/条形图/收敛曲线）。
- 扩展至“订单紧迫度（宽松/中等/紧张）”场景的30次对比，以验证在不同到期分布下的算法相对优势。

已生成图表（paper/figures）：
- `m6s2_profit_box_by_scenario.png`（利润箱线图：低/中/高各一子图，含三算法）
- `m6s2_utilization_rate_bars_by_scenario.png`（产线利用率：均值±标准差条形图）
- `m6s2_on_time_rate_bars_by_scenario.png`（准时率：均值±标准差条形图）
- `m6s2_penalty_rate_bars_by_scenario.png`（罚金触发率：均值±标准差条形图）


### 阶段1结果摘要（M6 核心验证：1场景×10次×3算法）
- 数据来源：
  - `experiments/batch_ga-only-m6core_summary.csv`
  - `experiments/batch_ga-vns-m6core_summary.csv`
  - `experiments/batch_ga-vns-sa-m6core_summary.csv`（重复条目按 seed 去重，保留最新）
- 固定种子集合：`404..413`（10 次）；视野：`--horizon 7`；GA参数：`--generations 60 --pop 50 --pc 0.8 --pm 0.08`；VNS参数：`--ls_rounds 3 --ls_attempts 120`；SA参数：`--sa_initial_temp 800 --sa_cooling 0.95 --sa_temps 30 --sa_moves_per_temp 300`。

- 算法均值（10 次）：
  - GA（baseline）：
    - `profit` 平均 ≈ `1058.00`
    - `utilization_rate` ≈ `0.5841`；`on_time_rate` ≈ `0.0125`；`penalty_rate` ≈ `0.9875`
    - `wage_cost` ≈ `178,850.00`；`production_cost` ≈ `109,868.00`；`penalty` ≈ `40,280.00`；`total_revenue` ≈ `330,056.00`
  - GA+VNS：
    - `profit` 平均 ≈ `748.00`（本数据集下 VNS 未超过 GA）
    - `utilization_rate` ≈ `0.5786`；`on_time_rate` ≈ `0.0000`；`penalty_rate` ≈ `1.0000`
    - `wage_cost` ≈ `175,850.00`；`production_cost` ≈ `110,324.00`；`penalty` = `40,830.00`；`total_revenue` ≈ `327,752.00`
  - GA+VNS+SA（高强度SA）：
    - `profit` 平均 ≈ `5,824.00`（显著优于 GA/GA+VNS）
    - `utilization_rate` ≈ `0.7016`；`on_time_rate` ≈ `0.1250`；`penalty_rate` ≈ `0.8750`
    - `wage_cost` ≈ `211,520.00`；`production_cost` ≈ `130,884.00`；`penalty` ≈ `35,556.00`；`total_revenue` ≈ `383,784.00`

- 对比结论：
  - 在 7 天视野与默认订单下，GA+VNS+SA 将均值利润提升至约 `+5.8k`，相较 GA 提升显著，同时提高产线利用率、降低罚金触发率并使部分运行达到更高准时率。
  - GA+VNS 在本数据集下未明显超过 GA，说明仅靠邻域微调不足以跳出结构性局部最优；引入 SA 的接受-拒绝机制与高温探索在此场景更有效。
  - 建议后续扩展到阶段2（多场景×30次），并针对 SA 参数做适度调优（如增大 `moves_per_temp/temps`）以进一步验证稳定性与上限。

记录与留痕：上述三组汇总 CSV 已生成于 `experiments/` 目录；单次运行目录以 `run-YYYYMMDD_HHMMSS_<tag>_seed<SEED>/` 命名，含 `config/orders/schedule/metrics/summary.md`。

### 阶段2准备（场景支持与批量）
- Runner 已支持场景工资系数参数：
  - 单场景：`--scenario {wage-low|wage-medium|wage-high}`
  - 多场景：`--scenarios wage-low wage-medium wage-high --append_scenario_to_tag`
  - 自动生成场景配置：将 `wage_multiplier_per_slot` 覆写并写入 `experiments/scripts/config_<scenario>.json`，调用 `src.main --config <该文件>`。
- 推荐批量命令模板（每场景×10次，三算法）：
  - GA：`python -m src.experiments.runner --exp_tag ga-only-m6s2 --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 --scenarios wage-low wage-medium wage-high --append_scenario_to_tag --seed-start 500 --seed-end 509`
  - GA+VNS：`python -m src.experiments.runner --exp_tag ga-vns-m6s2 --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 --local_search vns --ls_rounds 3 --ls_attempts 120 --scenarios wage-low wage-medium wage-high --append_scenario_to_tag --seed-start 500 --seed-end 509`
  - GA+VNS+SA：`python -m src.experiments.runner --exp_tag ga-vns-sa-m6s2 --horizon 7 --generations 60 --population 50 --crossover 0.8 --mutation 0.08 --local_search vns --ls_rounds 3 --ls_attempts 120 --sa_enabled --sa_initial_temp 800 --sa_cooling 0.95 --sa_moves_per_temp 300 --sa_temps 30 --scenarios wage-low wage-medium wage-high --append_scenario_to_tag --seed-start 500 --seed-end 509`
- 后续扩展：将 `--seed-end` 扩展到 529，即每场景×30次。

## M7 论文撰写与交付
> **优化建议**：论文撰写应提前开始（M3后），M7主要是完善和定稿。重点完善"优缺点与改进"部分，明确算法局限和未来方向。

- [ ] 论文完善：完善"优缺点与改进"部分，明确算法局限和未来方向；
- [ ] 论文定稿：问题描述、模型、算法、实验、讨论、结论与展望；
- [ ] 敏感性分析与补充图表整理（如果时间允许）；
- [ ] 复现实验脚本整理与说明（README）；
- [ ] 最终质量检查：随机抽查 3 次复现、结果一致性验证；
- [ ] 打包提交：代码、数据、论文 PDF、复现实验脚本、关键结果图表。

验收标准：
- 论文结构完整、图表与统计方法清晰；复现说明可按步骤运行且结果一致。

---

## 当日节奏建议（团队执行）
- 上午：编码与单元验证（PR 走查后合并）。
- 下午：跑批与数据归档（`experiments/` 留痕）。
- 晚上：更新迭代日志（`设计与实现方案.md` 与 `paper/` ）。

## 附：常用运行命令模板
```
python -m src.main --horizon <H> --generations <G> --pop <N> --pc <0.x> --pm <0.x> \
  --config data/config.json --orders data/orders.json --out results \
  --runs_dir experiments --exp_tag <tag> --seed <seed>
```

---

### 阶段2.1（软截止引导参数消融：h14 vs h30）

- 输入数据：`experiments/batch_ga-vns-soft-h14_summary.csv` 与 `experiments/batch_ga-vns-soft-h30_summary.csv`（当前包含种子 404–406，初步评估）。
- 生成图表（paper/figures）：
  - `m6s2_soft_profit_bars.png`
  - `m6s2_soft_utilization_rate_bars.png`
  - `m6s2_ttests_summary.md`（配对t检验摘要，含三场景四指标）

---

### 实验冻结点（M6 阶段2 快速收尾）

- 冻结时间：2025-11-10（当日）
- 冻结范围：
  - 三场景（低/中/高工资）× 三算法（GA/GA+VNS/GA+VNS+SA）的批量对比与图表；
  - 软截止引导参数消融（h14 vs h30）的初步结果与图表；
  - 配对 t 检验摘要（Δ、t、p），保存于 `paper/figures/m6s2_ttests_summary.md`。
- 素材清单（用于论文“实验与结果”）：
  - 图表（paper/figures）：
    - `m6s2_profit_box.png`, `m6s2_utilization_rate_bars.png`, `m6s2_on_time_rate_bars.png`, `m6s2_penalty_rate_bars.png`
    - `m6s2_soft_profit_bars.png`, `m6s2_soft_utilization_rate_bars.png`, `m6s2_soft_on_time_rate_bars.png`, `m6s2_soft_penalty_rate_bars.png`
    - `m6s2_ttests_summary.md`
  - 汇总CSV（experiments）：
    - `batch_ga-only-m6s2-wage-{low,medium,high}_summary.csv`
    - `batch_ga-vns-m6s2-wage-{low,medium,high}_summary.csv`
    - `batch_ga-vns-sa-m6s2-wage-{low,medium,high}_summary.csv`
    - `batch_ga-vns-soft-h14_summary.csv`, `batch_ga-vns-soft-h30_summary.csv`
  - 脚本（experiments/scripts）：
    - `plot_m6s2_figures.py`, `compute_m6s2_tests.py`, `plot_soft_ablation_figures.py`
  - 文档：`设计与实现方案.md`, `方案评估与优化建议.md`, `实验步骤记录.md`
- 后续工作切换：进入 M7 论文撰写与交付；如需增强鲁棒性，可选做扩展（软截止消融扩展到10次、TS/PSO留作未来工作）。
  - `m6s2_soft_on_time_rate_bars.png`
  - `m6s2_soft_penalty_rate_bars.png`
- 统计摘要（均值±标准差；当前 3 次）：
  - 利润：h14 = `-91816.67 ± 6833.28`，h30 = `-673410.00 ± 11523.96`
  - 利用率：h14 = `0.4735 ± 0.0092`，h30 = `0.5012 ± 0.0047`
  - 准时率：两者均为 `0.0000 ± 0.0000`
  - 罚金触发率：两者均为 `1.0000 ± 0.0000`
- 初步结论：
  - h14 明显优于 h30 的利润表现；h30 虽略增利用率但工资成本显著上升，导致利润极差；
  - 在当前设定下，软截止未改善准时率与罚金触发；需配合提高截止权重或软罚项系数，或调整订单“紧迫度”分布。
- 后续行动：补全种子至 `500–509`（各10次）以形成更稳定结论，并进行配对或非参数检验。